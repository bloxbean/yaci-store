(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[71],{2044:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/design",function(){return n(1616)}])},1616:function(e,t,n){"use strict";n.r(t),n.d(t,{__toc:function(){return g},default:function(){return b}});var i=n(5893),o=n(2673),s=n(6231),r=n(2069);n(9488);var a=n(2643),l={src:"/_next/static/media/component-diagram.dba77997.png",height:972,width:1499,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAIAAAD38zoCAAAAfUlEQVR42g2MvQrCMBRG8/5P4qK7q9BBB3EQiggVNNAfaxtzk7a5P2nvx3eWMxxDLC4kB4uP2P6g/roFRWfU7k52X9SHojte+8HjnBiJjG3/HVTPfrg39jV66+LjE+KMJiGta54wXKpbMybkrClmNgoRE+dz6cq3D6AHEdkAFJhvo4GkNEcAAAAASUVORK5CYII=",blurWidth:8,blurHeight:5},d={src:"/_next/static/media/store-design.9c146beb.png",height:1214,width:2182,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAIAAAA8r+mnAAAAWElEQVR42hWJMQqAMBAE8//viO/QVlCQdCmEJIXJ3e4lnrCwM0zoQlV2QROIUvEPsFBKba0B6KJmYwwD6BdEHYw2SJtz7leO6XUIHlWFpMuWnuW41zNeuX5AklwsxfHNPAAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:4},c={src:"/_next/static/media/store-sequential-diagram.883bc0fa.png",height:1522,width:2686,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAIAAAD38zoCAAAAfklEQVR42g3BSQrCMBQA0PyfoZKqCYig4AGcwPufQdwVEXTrMtoimplv3wP36q2ZEVHX3VuzeH/CJEZFSSj2dS4JKc+X5/Gkbo/roZ1z+ImcQioMOde6wREgSMGwEYXb9dIyxoIfADbGTLFWrBFLDt77nPNK94rTbrv3FYdAf+IAN89hVi60AAAAAElFTkSuQmCC",blurWidth:8,blurHeight:5},h={src:"/_next/static/media/store-parallel-diagram.c515bc57.png",height:1522,width:2702,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAmUlEQVR4nB3NUQqCMAAG4F8RTZmSkOJDj9FD979ApwjJrDSKOcGV1ea0LfAAH5/1fPVGTwrn8oI0y3DIG2w3CVzXlnJQe6ulNyOUQeD7cD0PeV4jCG30nGElJlj3qjBvoTGOI0gUojxxOMEXnNbYLSI9Fz3vZp2kKSht0XQUj2uBtTSwGGNGCgFCCJZxjKo4QjsOlBrw+wj8Af5kUqmk7wb3AAAAAElFTkSuQmCC",blurWidth:8,blurHeight:5};let g=[{depth:2,value:"Goals",id:"goals"},{depth:2,value:"Yaci Store - Design",id:"yaci-store---design"},{depth:3,value:"Core",id:"core"},{depth:3,value:"Stores",id:"stores"},{depth:3,value:"Aggregates",id:"aggregates"},{depth:3,value:"Persistence",id:"persistence"},{depth:3,value:"Tx Submission",id:"tx-submission"},{depth:2,value:"Stores - Components",id:"stores---components"},{depth:2,value:"Handling Rollbacks",id:"handling-rollbacks"},{depth:2,value:"Idempotency",id:"idempotency"},{depth:2,value:"Yaci Store - Sequential Block Processing",id:"yaci-store---sequential-block-processing"},{depth:2,value:"Yaci Store - Parallel Block Processing",id:"yaci-store---parallel-block-processing"}];function p(e){let t=Object.assign({h2:"h2",p:"p",ul:"ul",li:"li",img:"img",h3:"h3",code:"code",strong:"strong"},(0,a.a)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"goals",children:"Goals"}),"\n",(0,i.jsx)(t.p,{children:"Some of the high-level goals of Yaci Store are:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Providing a Java library for creating scoped indexers."}),"\n",(0,i.jsx)(t.li,{children:"Handling the common logic required for data indexing."}),"\n",(0,i.jsx)(t.li,{children:"Allowing applications to select the data they wish to index."}),"\n",(0,i.jsx)(t.li,{children:"Enabling developers to filter data based on various conditions."}),"\n",(0,i.jsx)(t.li,{children:"Permitting developers to override default behaviors."}),"\n",(0,i.jsx)(t.li,{children:"Managing rollbacks."}),"\n",(0,i.jsx)(t.li,{children:"Offering an out-of-the-box application for indexing common data."}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"yaci-store---design",children:"Yaci Store - Design"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"High Level Design",placeholder:"blur",src:l})}),"\n",(0,i.jsx)(t.h3,{id:"core",children:"Core"}),"\n",(0,i.jsxs)(t.p,{children:["The core module is the backbone of Yaci Store. It is responsible for reading data from Cardano blockchain and broadcasting events.\nIt also monitors and records the current point in the database.\nEvents are published as ",(0,i.jsx)(t.code,{children:"Spring events"}),", so developers can write their own Spring event listeners to listen these events and process them accordingly."]}),"\n",(0,i.jsx)(t.h3,{id:"stores",children:"Stores"}),"\n",(0,i.jsx)(t.p,{children:"Each store is a specialized module designed for a specific data type or use case."}),"\n",(0,i.jsx)(t.p,{children:"A store has the ability to:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Listen to events published by the core module."}),"\n",(0,i.jsx)(t.li,{children:"Process data."}),"\n",(0,i.jsx)(t.li,{children:"Store data in a persistent store."}),"\n",(0,i.jsx)(t.li,{children:"Publish derived events. (Optional)"}),"\n",(0,i.jsx)(t.li,{children:"Provide REST endpoints to retrieve data (optional)."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Each of the above functionalities can be overridden by developers through the use of Spring Beans."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Note:"})," To simplify the rollback process, stores do not handle any data aggregation."]}),"\n",(0,i.jsx)(t.h3,{id:"aggregates",children:"Aggregates"}),"\n",(0,i.jsxs)(t.p,{children:['Aggregates are modules that handle different kind of data aggregation. They are responsible for aggregating data from different stores and persisting them in a persistent store.\nCurrently, the only available aggregate is "Account", which provides account balance related data. It depends on the "utxo" store and the event published by utxo store.\nBut status of this module is still ',(0,i.jsx)(t.strong,{children:"experimental"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"persistence",children:"Persistence"}),"\n",(0,i.jsxs)(t.p,{children:["By default, Yaci Store uses a relational database to store data. The database schema is generated automatically by Flyway.\nSupported databases include: ",(0,i.jsx)(t.strong,{children:"PostgreSQL"}),", ",(0,i.jsx)(t.strong,{children:"MySQL"}),", ",(0,i.jsx)(t.strong,{children:"H2"})]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"An application can also use a custom persistence store by implementing a store's Storage api."})}),"\n",(0,i.jsx)(t.h3,{id:"tx-submission",children:"Tx Submission"}),"\n",(0,i.jsx)(t.p,{children:'The "submit" module provides the ability to submit transactions to nodes directly, either through n2c or the submit API.'}),"\n",(0,i.jsx)(t.h2,{id:"stores---components",children:"Stores - Components"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Store Design",placeholder:"blur",src:d})}),"\n",(0,i.jsxs)(t.p,{children:["A ",(0,i.jsx)(t.strong,{children:"store"})," is composed of the following components:"]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"1. Processor:"})," A processor is responsible for processing data. It listens to events published by the core module and processes the data contained in the event. A processor can also publish derived events.\nFor example: ",(0,i.jsx)(t.code,{children:"UtxoProcessor"})," in the ",(0,i.jsx)(t.code,{children:"utxo"})," store listens to TransactionEvent and processes the UTxOs contained in the transaction. It also publishes ",(0,i.jsx)(t.code,{children:"AddressUtxo"})," derived event for each UTxO."]}),"\n",(0,i.jsx)(t.p,{children:"Developer can write their own processor by listening to events published by the core module."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"2. Storage:"})," A storage defines the interface for storing data. The implementation of a storage api is responsible for storing data in a persistent store.\nBy default, Yaci Store uses a relational database to store data and each store provides a default implementation of corresponding storage api using JPA."]}),"\n",(0,i.jsx)(t.p,{children:"This can be overridden by developers by implementing the storage api in consuming applications."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"3. Controller:"})," A controller provides REST endpoints to retrieve store's data. It uses the storage api to retrieve data from the persistent store.\nOut of the box, Yaci Store provides some common REST endpoints for all stores. But, developers can implement their own REST endpoints."]}),"\n",(0,i.jsx)(t.h2,{id:"handling-rollbacks",children:"Handling Rollbacks"}),"\n",(0,i.jsxs)(t.p,{children:["Yaci Store follows a simply strategy to handle rollbacks. As ",(0,i.jsx)(t.code,{children:"store"})," modules don't handle any data aggregation, the rollback handling becomes simple.\nEach table in a store maintains a ",(0,i.jsx)(t.code,{children:"slot"})," column. When a processor received a ",(0,i.jsx)(t.code,{children:"RollbackEvent"})," event, it deletes all the records with a slot greater than\nthe rollback slot mentioned in the event."]}),"\n",(0,i.jsxs)(t.p,{children:["But as aggregates handle data aggregation, the rollback handling becomes a bit complex. But with a simple strategy, we can handle rollbacks in aggregates as well.\n",(0,i.jsx)(t.strong,{children:"For example,"})," the ",(0,i.jsx)(t.code,{children:"Account"})," module aggregates account balance. But instead of storing the account balance for an address in one record, balance snapshot is stored for a slot.\nAs we don't update existing records during aggregation, rollback can be handled by simply deleting all the records with a slot greater than the rollback slot mentioned in the event."]}),"\n",(0,i.jsx)(t.p,{children:"If you are using Yaci Store as a library in your application with your own domain model and tables, you can follow the similar strategy to handle rollbacks."}),"\n",(0,i.jsx)(t.h2,{id:"idempotency",children:"Idempotency"}),"\n",(0,i.jsx)(t.p,{children:"Though Yaci Store ensures that the same event is not published more than once, it is possible that the same event is published more than once in some scenarios. All out-of-box\nmodules are idepotent. But if you are writing your own stores, you should make sure that your modules are idempotent."}),"\n",(0,i.jsx)(t.h2,{id:"yaci-store---sequential-block-processing",children:"Yaci Store - Sequential Block Processing"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Sequential Processing",placeholder:"blur",src:c})}),"\n",(0,i.jsx)(t.h2,{id:"yaci-store---parallel-block-processing",children:"Yaci Store - Parallel Block Processing"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Parallel Processing",placeholder:"blur",src:h})})]})}let u={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:t}=Object.assign({},(0,a.a)(),e.components);return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(p,{...e})}):p(e)},pageOpts:{filePath:"pages/design.mdx",route:"/design",timestamp:171552801e4,pageMap:[{kind:"Meta",data:{index:"Overview",design:"Design",docker:"Docker",build_run:"Build & Run",usage:{title:"Usage"},stores:"Stores",about:{title:"About",type:"page"}}},{kind:"MdxPage",name:"about",route:"/about"},{kind:"MdxPage",name:"build_run",route:"/build_run"},{kind:"MdxPage",name:"design",route:"/design"},{kind:"MdxPage",name:"docker",route:"/docker"},{kind:"MdxPage",name:"index",route:"/"},{kind:"Folder",name:"stores",route:"/stores",children:[{kind:"MdxPage",name:"overview",route:"/stores/overview"},{kind:"Meta",data:{overview:"Overview"}}]},{kind:"Folder",name:"usage",route:"/usage",children:[{kind:"Meta",data:{"getting-started-as-library":"As Library","getting-started-out-of-box":"Out of Box Indexers","aggregation-app-getting-started":"Aggregation App (Account Balance)"}},{kind:"MdxPage",name:"aggregation-app-getting-started",route:"/usage/aggregation-app-getting-started"},{kind:"MdxPage",name:"getting-started-as-library",route:"/usage/getting-started-as-library"},{kind:"MdxPage",name:"getting-started-out-of-box",route:"/usage/getting-started-out-of-box"}]}],flexsearch:{codeblocks:!0},title:"Design",headings:g},pageNextRoute:"/design",nextraLayout:s.ZP,themeConfig:r.Z};var b=(0,o.j)(u)},2069:function(e,t,n){"use strict";var i=n(5893);n(7294);let o={logo:(0,i.jsx)("span",{children:(0,i.jsx)("b",{children:"Yaci Store"})}),project:{link:"https://github.com/bloxbean/yaci-store"},chat:{link:"https://discord.gg/JtQ54MSw6p"},docsRepositoryBase:"https://github.com/bloxbean/yaci-store/tree/main/docs",footer:{text:"\xa9 2024 BloxBean project"},useNextSeoProps:()=>({titleTemplate:"%s â€“ Yaci Store"}),head:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("meta",{property:"description",content:"Yaci Store - A modular Java library for developers who are keen on building their own custom indexer for Cardano"}),(0,i.jsx)("meta",{property:"og:title",content:"Yaci Store - A modular Java library for developers who are keen on building their own custom indexer for Cardano"}),(0,i.jsx)("meta",{property:"og:description",content:"Yaci Store - A modular Java library for developers who are keen on building their own custom indexer for Cardano"})]})};t.Z=o},5789:function(){}},function(e){e.O(0,[955,888,774,179],function(){return e(e.s=2044)}),_N_E=e.O()}]);