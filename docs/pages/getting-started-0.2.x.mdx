# What’s New in `0.2.0-beta1`

This is the **first beta release of Yaci Store with ledger-state support**. Yaci Store can now **calculate and derive ledger state**—such as **rewards**, **ADAPot**, and **governance state**—from **on-chain data**.

Unlike DB Sync, which receives ledger events directly from a local Cardano Node (both implemented in Haskell), **Yaci Store independently computes all required ledger state from the on-chain data itself.**

---

## Status of Ledger State Data Accuracy

So far, **apart from a few dRep distribution mismatches in earlier Preview epochs**, Yaci Store's ledger-state calculations **match DB Sync values** across recent epochs on **Mainnet** and **Preprod** networks.

These calculations include:
- Epoch rewards
- ADAPot values
- Governance state (dRep distribution, proposal status, dRep status)

> 🔎 Mismatch details for Preview can be found [here](#).
> 🛠 We will address these issues in the next beta and continue to monitor results alongside DB Sync and the Cardano Node for upcoming epochs.

---

> **Note:**
> If you're testing ledger-state calculation, we recommend starting with **Preview** or **Preprod** networks before trying **Mainnet**.
> You may also need to **tune your PostgreSQL configuration** when running on Mainnet due to higher resource requirements.

---

## Known Issues or Limitations

1. **Performance of Reward Calculation on Mainnet**
   - Ledger-state calculations currently happen **during epoch transition**.
     That means **rewards paid in epoch X are calculated during the transition from epoch X-1 to X**.
   - On Mainnet, this takes around **20–30 minutes** per transition (depends on your PostgreSQL resources).
   - In a future release, we plan to start **reward calculation in epoch X-1 after the stability window**, similar to how the Haskell node works.
     This will reduce the computation load during epoch boundaries.

---

## Out-of-the-Box Applications

### 1. **Yaci Store App**
- The **default indexer application**, includes all modules.
- **Ledger-state calculation is disabled by default** but can be enabled via profile.

### 2. **Ledger State App**
- Contains only the modules needed for **ledger-state calculation**.
- Excludes modules like metadata and script that are unnecessary for this purpose.

### 3. **Yaci Store Admin CLI App**
- CLI tool to **apply optional indexes after sync is complete**.
- Optional indexes improve API query performance and are not applied during initial sync.

---

## Types of Distribution

Yaci Store provides three types of distributions:

1. **Yaci Store Zip Distribution (JARs)**
2. **Yaci Store Docker Distribution**
3. **Yaci Store Native (GraalVM) Distribution** *(Preview)*

---

### 1. Yaci Store Zip Distribution (JARs)

Filename: `yaci-store-<version>.zip`

Includes:
- `yaci-store.jar`
- `yaci-store-ledger-state.jar`
- Config files (`application.properties`)

#### Usage

- **To run Yaci Store (without ledger-state):**
  ```bash
  ./bin/start.sh
  ```

- **To enable ledger-state calculation:**
  ```bash
  ./bin/start.sh ledger-state
  ```

- **To run Ledger State App only:**
  ```bash
  ./bin/start-ledger-state.sh
  ```

#### 1.1 Apply Optional Indexes

After the initial sync is complete:

```bash
./bin/yaci-cli.sh
```

This launches the Admin CLI (`yaci-store-admin-cli.jar`). At the CLI prompt:

```bash
yaci-store> apply-indexes
```

---

### 2. Yaci Store Docker Distribution

This ZIP includes Docker Compose files for:
- PostgreSQL
- Yaci Store app
- Ledger State app

You can choose between:
- **Monolith setups** (run both Postgres and indexer app)
- **App-specific setups** (connect to an external DB)

#### Usage

1. Edit `application.properties` to configure network and database settings.

2. Start containers:

- **Yaci Store with Postgres**:
  ```bash
  docker compose -f yaci-store-monolith.yml up
  ```

- **Ledger State with Postgres**:
  ```bash
  docker compose -f yaci-store-ledger-state-monolith.yml up
  ```

- **Access PostgreSQL DB**:
  ```bash
  ./psql.sh postgres-compose.yml
  ```

#### 2.1 Apply Indexes After Sync

Once sync is complete:

```bash
./admin-cli.sh
```

This runs the Admin CLI in a container. Then, at the prompt:

```bash
yaci-store> apply-indexes
```

---

### 3. Yaci Store Native (GraalVM) Distribution *(Preview)*

Native binaries are available under a separate release tag:
`<version>-native` (e.g., `0.2.0-beta-native`)

#### Download Format

Look for platform-specific ZIP files in this format:

```text
yaci-store-<version>-<os>-<arch>-all.zip
```

Example:

```text
yaci-store-0.2.0-preview2-linux-x64-all.zip
```

> ⚠️ Only use the ZIP files ending with `-all`.
> Ignore files ending with `n2c`.

#### Setup

1. Extract the ZIP.
2. Edit `config/application.properties` to configure:
   - Cardano network info (host/port/protocol magic)
   - PostgreSQL connection settings

3. Run the app:

```bash
./yaci-store
```

4. Run with ledger-state profile:

```bash
SPRING_PROFILES_ACTIVE=ledger-state ./yaci-store
```
