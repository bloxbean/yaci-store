&nbsp;

# ğŸš€ Getting Started - Write your first plugin

Welcome to the Yaci Store Plugin Framework! This guide will walk you through creating your first plugin from scratch.

---

## ğŸ¯ What You'll Build

In this tutorial, you'll create a simple plugin that:
- Filters metadata based on specific labels
- Logs transaction events 
- Demonstrates basic plugin lifecycle

---

## ğŸ“‹ Prerequisites

Before you start, ensure you have:
- âœ… Yaci Store v2.0.0 or later
- âœ… Basic knowledge of JavaScript, Python, or Java
- âœ… Understanding of Cardano blockchain concepts

---

## ğŸ”§ Plugin Types Overview

Choose the plugin type that fits your needs:

### ğŸ“¥ Storage Plugin
Perfect for filtering and processing data before storage.

### ğŸ§ Event Handler Plugin  
Ideal for reacting to blockchain events in real-time.

---

## ğŸ—ï¸ Your First Plugin: Metadata Filter

Let's create a metadata filter plugin that only stores metadata with specific labels.

### Step 1: Create Plugin Directory

```bash
mkdir my-first-plugin
cd my-first-plugin
```

### Step 2: Create Plugin Configuration

Create `plugin.yml`:

```yaml
name: metadata-filter
version: 1.0.0
description: Filter metadata by specific labels
type: storage
language: javascript

hooks:
  - extensionPoint: "metadata.save"
    type: "filter"
    script: "filter-metadata.js"
```

### Step 3: Write the Filter Logic

Create `filter-metadata.js`:

```javascript
// Filter function - return true to store, false to skip
function filter(metadata, context) {
    // Only store metadata with label 721 (NFT metadata)
    if (metadata.label === '721') {
        console.log('Storing NFT metadata for tx: ' + metadata.txHash);
        return true;
    }
    
    // Skip other metadata
    return false;
}

// Export the filter function
filter;
```

### Step 4: Access Context Variables

Your plugin has access to powerful context variables:

```javascript
function filter(metadata, context) {
    // Access database
    const count = jdbc.queryForObject(
        "SELECT COUNT(*) FROM tx_metadata WHERE label = ?", 
        ['721']
    );
    
    // Use HTTP client
    const response = http.get('https://api.example.com/metadata');
    
    // Store in plugin state
    state.lastProcessed = new Date().toISOString();
    
    // Access global configuration
    const maxItems = env.getProperty('plugin.metadata.maxItems', '1000');
    
    return metadata.label === '721' && count < parseInt(maxItems);
}
```

---

## ğŸ Python Example

Prefer Python? Here's the same plugin:

### `plugin.yml`:
```yaml
name: metadata-filter-python
version: 1.0.0
description: Filter metadata using Python
type: storage
language: python

hooks:
  - extensionPoint: "metadata.save"
    type: "filter" 
    script: "filter_metadata.py"
```

### `filter_metadata.py`:
```python
def filter_metadata(metadata, context):
    """Filter metadata by label"""
    
    # Access context variables
    jdbc = context.get('jdbc')
    state = context.get('state')
    
    # Only process NFT metadata
    if metadata.get('label') == '721':
        # Log the action
        print(f"Processing NFT metadata for tx: {metadata.get('txHash')}")
        
        # Store processing timestamp
        state['lastProcessed'] = str(datetime.now())
        
        return True
    
    return False

# Return the filter function
filter_metadata
```

---

## ğŸ§ Event Handler Plugin Example

Create a plugin that reacts to new blocks:

### `block-logger.yml`:
```yaml
name: block-logger
version: 1.0.0
description: Log new block events
type: event-handler
language: javascript

events:
  - event: "BlockEvent"
    script: "log-blocks.js"
```

### `log-blocks.js`:
```javascript
function handleBlockEvent(blockEvent, context) {
    const block = blockEvent.block;
    
    console.log(`New block received:
        Number: ${block.number}
        Hash: ${block.hash}
        Slot: ${block.slot}
        Transactions: ${block.transactions.length}
    `);
    
    // Store block info in global state
    global_state.lastBlockNumber = block.number;
    global_state.lastBlockTime = new Date().toISOString();
    
    // Optional: Send notification
    http.post('https://webhook.example.com/blocks', {
        blockNumber: block.number,
        txCount: block.transactions.length
    });
}

// Export the handler
handleBlockEvent;
```

---

## ğŸ“¦ Installing Your Plugin

### Option 1: File-based Installation

1. Copy your plugin folder to `/plugins/` directory
2. Restart Yaci Store
3. Plugin will be auto-discovered and loaded

### Option 2: Configuration-based

Add to `application.yml`:

```yaml
yaci:
  store:
    plugins:
      enabled: true
      locations:
        - "/path/to/my-first-plugin"
      metadata-filter:
        enabled: true
        config:
          maxItems: 500
```

---

## ğŸ” Testing Your Plugin

### Enable Debug Logging

```properties
logging.level.com.bloxbean.cardano.yaci.store.plugins=DEBUG
```

### Verify Plugin Loading

Check the logs for:

```
âœ… Plugin 'metadata-filter' loaded successfully
âœ… Registered hook: metadata.save -> filter
âœ… Plugin context initialized with 6 variables
```

### Test with Sample Data

Your plugin will now filter metadata as transactions are processed!

---

## ğŸš¨ Common Troubleshooting

### Plugin Not Loading?
- Check plugin.yml syntax
- Verify file permissions
- Review error logs

### JavaScript Errors?
- Ensure ES5 compatibility
- Avoid Node.js specific modules
- Use provided context variables

### Python Issues?
- Check Python path configuration
- Avoid native extensions in concurrent plugins
- Use context variables for external access

---

## ğŸ¯ Next Steps

Now that you've created your first plugin:

1. ğŸ“– [Explore the Plugin API Guide](./plugin-api-guide) for advanced features
2. ğŸ”§ [Learn about Context Variables](./context-variables) available to your plugins
3. âš™ï¸ [Master Plugin Configuration](./plugin-configuration) options

---

## ğŸ’¡ Plugin Ideas to Explore

- **Address Tracker**: Monitor specific addresses and alert on transactions
- **Token Filter**: Only index tokens from specific policy IDs  
- **Analytics Collector**: Gather custom metrics and export to external systems
- **Notification System**: Send alerts based on blockchain events
- **Data Enrichment**: Add external data to stored blockchain information

Ready to build something amazing? Let's dive deeper into the Plugin API! ğŸš€