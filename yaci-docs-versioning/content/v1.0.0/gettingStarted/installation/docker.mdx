&nbsp;

# 🐳 Run with Docker Compose

There are three out-of-the-box applications available in the Yaci Store repository:

- **Yaci Store Utxo Indexer**: Includes Utxo Store, Epoch Store, and Submit component  
- **Yaci Store All**: Includes all stores  
- **Yaci Store Aggregation**: Aggregates account balances

You can run these applications using Docker Compose. The Docker Compose YAML files are located in the `docker` folder of the [Yaci Store GitHub repository](https://github.com/bloxbean/yaci-store).

> ✅ Please clone the repository and verify that the compose YAML files are pointing to the correct application image version.

---

## 📦 Pre-requisites

- **Docker**

---

## ⚙️ Environment Files

There are three configuration files available in the `docker` folder:

- `env`: Contains environment variables (e.g., `JAVA_OPTS`)
- `application.properties`: Contains application-specific properties such as Cardano node host, port, database info, and store configuration
- `application-aggr.properties`: Contains properties specific to the aggregation application

> ⚠️ Make sure to configure **Cardano Host**, **Port**, and **Protocol Magic** in `application.properties`.

---

## 🐘 Docker Compose Files

In the examples below, we use `*-monolith.yml` files. These allow you to run both **PostgreSQL** and the **application** in a single Docker Compose process.

If you'd like to use an **external database**, you can use application-specific Docker Compose files like:

- `yaci-store-all.yml`
- `yaci-store-utxo-indexer.yml`
- `yaci-store-aggregation.yml`

---

## 📊 DB Indexes (After Initial Sync)

During the **initial sync**, optional database indexes are automatically **removed** to speed up processing.

Once the sync is complete, you should **manually re-apply** those indexes for better query performance.

SQL files to restore indexes:

- **Yaci Store All App**: `create-index.sql`
- **Utxo Indexer App**: `create-index.sql`

---

## 🚀 Run Yaci Store ALL Application

This application includes all stores.

By default, the submit endpoint is **disabled**. Refer to the [Enable Submit Endpoint](#enable-submit-endpoint) section for details.

> 🛠️ You can disable specific stores or their API endpoints via `application.properties`:
>
> - Disable a store:  
>   `store.<store_name>.enabled=false`
> - Disable API endpoints:  
>   `store.<store_name>.api-enabled=false`

```bash
docker compose -f yaci-store-all-monolith.yml up -d
```
---

# 🧪 Swagger UI Access
---

You can access Swagger UI at:  
[http://localhost:8080/swagger-ui/index.html](http://localhost:8080/swagger-ui/index.html)

---

> ⚠️ **Note:**  
> When a store is disabled, its data will **not be processed or stored** in the database. However, the store-specific tables will still be created.  
> This behavior is expected to change in a future release.

---

## 📊 Account Aggregation


The **Yaci Store All** app includes the **account aggregation** module, but it is **disabled by default**.  
Instead of enabling it directly, it's recommended to run the **aggregation app** separately to calculate account balances.

---

## ⚡ Run UTXO Indexer Application


The UTXO Indexer application consists of:

- `utxo store`  
- `epoch store`  
- `submit` component

> By default, the **submit endpoint** is **disabled**.  
> Refer to [Enable Submit Endpoint](#enable-submit-endpoint) for activation.

```bash
docker compose -f yaci-store-utxo-indexer-monolith.yml up -d
```
---

# 🧮 Run Aggregation App
---

The **Aggregation App** is a separate application that calculates account balances by aggregating UTXO store data.

```bash
docker compose -f yaci-store-aggregation-monolith.yml up -d
```
---
# 🔐 Enable Submit Endpoint
---

Both the **yaci-store-all** and **yaci-store-utxo-indexer** applications provide:

- ✅ Submit endpoint  
- ✅ Script cost evaluation endpoint  

These endpoints are **disabled by default**.

---

## 🛠️ Configuration (in `application.properties`)

- To enable the **submit endpoint**, configure:

```properties
store.cardano.submit-api-url=<URL>
``` 
To enable both the **submit** and **script cost evaluation** endpoints, configure:

```properties
store.cardano.ogmios-url=<YOUR_OGMIOS_URL>
``` 

> 💡 **Note:**  
> If both `submit-api-url` and `ogmios-url` are configured:
>
> - `submit-api-url` is used for **transaction submission**
> - `ogmios-url` is used for **script cost evaluation**
