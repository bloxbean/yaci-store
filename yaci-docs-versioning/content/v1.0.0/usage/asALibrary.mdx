&nbsp;

# ğŸ“š Use Yaci Store as a Library

Yaci Store can be used as a **library in your own application**, giving you full control over what data you want to index. This is made possible by its **modular architecture** and **Spring dependency injection**.

For example, you can:

- Store only UTXOs for specific addresses
- Persist metadata with specific labels
- Use your own storage backend

---

## ğŸ§ª Sample Applications

- A metadata indexer project using Yaci Store as a library  
- A scoped indexer for Ada Handler

---

## âœ… Prerequisites

- **Java 21**
- **Spring Boot** `3.2.x` (tested with `3.2.0`, `3.2.1`, `3.2.2`)

---

## âš™ï¸ Create a Spring Boot Application

Use [Spring Initializr](https://start.spring.io/) to scaffold your Spring Boot app.

---

## ğŸ“¦ Add Dependencies

### Gradle (`build.gradle`)

```groovy
implementation 'com.bloxbean.cardano:yaci-store-spring-boot-starter:<version>'
```

### Maven (`pom.xml`)

```xml
<dependency>
  <groupId>com.bloxbean.cardano</groupId>
  <artifactId>yaci-store-spring-boot-starter</artifactId>
  <version>{version}</version>
</dependency>
```

---

## ğŸ§© Add Required Store Starters

For example, to include the metadata store:

### Gradle

```groovy
implementation 'com.bloxbean.cardano:yaci-store-metadata-spring-boot-starter:<version>'
```

### Maven

```xml
<dependency>
  <groupId>com.bloxbean.cardano</groupId>
  <artifactId>yaci-store-metadata-spring-boot-starter</artifactId>
  <version>{version}</version>
</dependency>
```

> ğŸ“˜ You can include multiple store starters. Full list of supported starters is available in the documentation.

---

## ğŸ› ï¸ Flyway Configuration

Add the following to your `application.yml`:

```yaml
spring:
  flyway:
    locations: classpath:db/store/{vendor}
    out-of-order: true

apiPrefix: /api/v1
```

> ğŸ“ For Yaci Store `0.0.11` or earlier, use `classpath:db/migration/{vendor}` instead.

You can also define your own Flyway locations for custom migrations.

---

## ğŸ§¾ Yaci Store Configuration

Download the `application.properties` file from the release page and place it in a folder named `config` at the root of your project.

Alternatively, add the configs directly into `application.yml`.

### ğŸ”Œ Network Configuration

```properties
store.cardano.host=preprod-node.world.dev.cardano.org
store.cardano.port=30000
store.cardano.protocol-magic=1
```

### ğŸ—„ï¸ Database Configuration

```properties
spring.datasource.url=
spring.datasource.username=user
spring.datasource.password=
```

---

## âš™ï¸ Optional Configuration

### ğŸŒ Genesis Files

Genesis files are required for certain modules (e.g., UTXO, epoch, aggregate):

```properties
store.cardano.byron-genesis-file=/path/to/byron-genesis.json
store.cardano.shelley-genesis-file=/path/to/shelley-genesis.json
store.cardano.alonzo-genesis-file=/path/to/alonzo-genesis.json
store.cardano.conway-genesis-file=/path/to/conway-genesis.json
```

For **mainnet**, **preprod**, or **preview**, these are included by default.

### ğŸ”— N2C (Node-to-Client) Configuration

Required for transaction submission and fetching protocol parameters:

```properties
#store.cardano.n2c-node-socket-path=/path/to/node.socket

# If using a relay (e.g., socat)
#store.cardano.n2c-host=<relay_host>
#store.cardano.n2c-port=<relay_port>
```

---

## ğŸš€ Application Startup

When you start your app:

- Yaci Store creates required tables
- Syncs blockchain data
- Publishes events for processing

---

## âš¡ Parallel Processing (Optional)

Enable parallel sync for faster performance:

```properties
store.executor.enable-parallel-processing=true
store.executor.blocks-batch-size=100
store.executor.blocks-partition-size=10
store.executor.use-virtual-thread-for-batch-processing=true
store.executor.use-virtual-thread-for-event-processing=true
```

---

## ğŸ§© Customization â€“ Override Default Behavior

### ğŸ—ƒï¸ Custom Storage

You can override the default storage implementation to:

- Use a different database
- Filter by metadata labels
- Store scoped data only

> ğŸ” See the sample projects for implementation references.

### âš™ï¸ Custom Processor

You can listen to core or derived events to perform custom logic. This is useful for:

- Filtering
- Analytics
- Auditing

### ğŸ” Rollback Handling

- **Default Storage**: Rollbacks are handled automatically.
- **Custom Storage**: You must handle `RollbackEvent` manually and ensure **idempotency**.

---

## ğŸ§¹ Remove Optional Indexes During Initial Sync

To speed up the initial sync:

1. Remove optional indexes listed in `drop-index.sql`
2. Re-add them after full sync using `create-index.sql`

> ğŸ’¡ Each store has its own index files in the repository.
